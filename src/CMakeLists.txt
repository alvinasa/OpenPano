cmake_minimum_required(VERSION 2.8)

find_package(PkgConfig REQUIRED)
pkg_check_modules(JPEG REQUIRED libjpeg)
find_package(Eigen3 REQUIRED)

find_package(OpenMP)

include_directories(${JPEG_INCLUDE_DIRS})
include_directories(/opt/devel/ref-pi/usr/include /opt/devel/ref-pi/usr/include/arm-linux-gnueabihf)
include_directories(SYSTEM ${EIGEN3_INCLUDE_DIR})

include_directories(SYSTEM third-party)
include_directories(.)

# our sources
file(GLOB SOURCES main.cc feature/*.[c,h]* stitch/*.[c.h]* lib/*.[c,h]*)
list(APPEND SOURCES
 ${CMAKE_CURRENT_SOURCE_DIR}/third-party/lodepng/lodepng.cc
)

if (OPENMP_FOUND)
	set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
endif()

add_definitions(-DDEBUG)

set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3 -g2")

if (CMAKE_VERSION VERSION_LESS "3.1")
	set (CMAKE_CXX_FLAGS "-std=c++11 ${CMAKE_CXX_FLAGS}")
else()
	set (CMAKE_CXX_STANDARD 11)
endif()

add_executable(image-stitching ${SOURCES})

target_link_libraries(image-stitching ${JPEG_LIBRARY_DIRS}/libjpeg.so)
# Build the library for polymorphision
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/stitch)
list(REMOVE_ITEM SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/main.cc)
list(APPEND SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/api.cc)
message(${SOURCES})
add_definitions(-DBUILD_OPEN_PANO)
add_library(openpano STATIC ${SOURCES})

# Visual Studio handling of file glob
# This part is not maintained.. I don't know what it is
if(MSVC)
  set_target_properties(
    image-stitching
    PROPERTIES
    GENERATED true
    EXTERNAL_OBJECT true
    LINK_FLAGS "setargv.obj"
    )
endif()
